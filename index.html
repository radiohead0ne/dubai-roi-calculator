<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dubai Real Estate ROI Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900">
    <div id="app"></div>
    <script>
        const app = document.getElementById('app');
        
        const state = {
            usdToAed: 3.6725,
            purchasePriceUSD: 204000,
            dldFeePercent: 4,
            adminFeeAED: 4000,
            propertySizeSqft: 800,
            serviceChargePerSqftAED: 15,
            occupancyRate: 90,
            completionYear: 2026,
            completionQuarter: 'Q2',
            downPaymentPercent: 20,
            duringConstructionPercent: 30,
            onHandoverPercent: 50,
            hasPHPP: false,
            phppPercent: 0,
            phppMonths: 24,
            hasMortgage: false,
            mortgageRate: 3.89,
            mortgageYears: 25,
            mortgagePercent: 50,
            annualRentUSD: 14000,
            annualRentIncrease: 10,
            holdingPeriodYears: 10
        };
        
        const convertToAED = (usd) => usd * state.usdToAed;
        const convertToUSD = (aed) => aed / state.usdToAed;
        const formatUSD = (v) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(v);
        const formatAED = (v) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'AED', minimumFractionDigits: 0 }).format(v);
        const formatNumber = (v) => new Intl.NumberFormat('en-US').format(v);
        
        function calculate() {
            const purchasePriceAED = convertToAED(state.purchasePriceUSD);
            const propertySizeM2 = state.propertySizeSqft / 10.764;
            const dldFeeAED = purchasePriceAED * (state.dldFeePercent / 100);
            const dldFeeUSD = convertToUSD(dldFeeAED);
            const adminFeeUSD = convertToUSD(state.adminFeeAED);
            const annualServiceChargeAED = state.serviceChargePerSqftAED * state.propertySizeSqft;
            const annualServiceChargeUSD = convertToUSD(annualServiceChargeAED);
            const downPaymentAED = purchasePriceAED * (state.downPaymentPercent / 100);
            const downPaymentUSD = state.purchasePriceUSD * (state.downPaymentPercent / 100);
            const duringConstructionAED = purchasePriceAED * (state.duringConstructionPercent / 100);
            const duringConstructionUSD = state.purchasePriceUSD * (state.duringConstructionPercent / 100);
            const onHandoverAED = purchasePriceAED * (state.onHandoverPercent / 100);
            const onHandoverUSD = state.purchasePriceUSD * (state.onHandoverPercent / 100);
            const phppAED = state.hasPHPP ? purchasePriceAED * (state.phppPercent / 100) : 0;
            const phppUSD = state.hasPHPP ? state.purchasePriceUSD * (state.phppPercent / 100) : 0;
            const phppMonthlyUSD = state.hasPHPP && state.phppMonths > 0 ? phppUSD / state.phppMonths : 0;
            const initialFeesAED = downPaymentAED + dldFeeAED + state.adminFeeAED;
            const initialFeesUSD = convertToUSD(initialFeesAED);
            
            let mortgageAmountAED = 0, mortgageAmountUSD = 0, monthlyMortgageAED = 0, monthlyMortgageUSD = 0;
            let totalMortgagePaidAED = 0, totalMortgagePaidUSD = 0;
            
            if (state.hasMortgage) {
                mortgageAmountAED = purchasePriceAED * (state.mortgagePercent / 100);
                mortgageAmountUSD = state.purchasePriceUSD * (state.mortgagePercent / 100);
                const monthlyRate = state.mortgageRate / 100 / 12;
                const totalNumPayments = state.mortgageYears * 12;
                if (monthlyRate > 0) {
                    monthlyMortgageAED = mortgageAmountAED * (monthlyRate * Math.pow(1 + monthlyRate, totalNumPayments)) / (Math.pow(1 + monthlyRate, totalNumPayments) - 1);
                    monthlyMortgageUSD = convertToUSD(monthlyMortgageAED);
                    totalMortgagePaidAED = monthlyMortgageAED * state.holdingPeriodYears * 12;
                    totalMortgagePaidUSD = convertToUSD(totalMortgagePaidAED);
                }
            }
            
            const actualCashInvestedAED = initialFeesAED + duringConstructionAED + (state.hasPHPP ? phppAED : 0) + (state.hasMortgage ? onHandoverAED - mortgageAmountAED : onHandoverAED);
            const actualCashInvestedUSD = convertToUSD(actualCashInvestedAED);
            
            let totalRentalIncomeAED = 0;
            let currentRentAED = convertToAED(state.annualRentUSD) * (state.occupancyRate / 100);
            for (let year = 1; year <= state.holdingPeriodYears; year++) {
                const annualMortgageThisYear = state.hasMortgage ? monthlyMortgageAED * 12 : 0;
                const netIncomeThisYear = currentRentAED - annualServiceChargeAED - annualMortgageThisYear;
                totalRentalIncomeAED += netIncomeThisYear;
                currentRentAED = currentRentAED * (1 + state.annualRentIncrease / 100);
            }
            
            const totalRentalIncomeUSD = convertToUSD(totalRentalIncomeAED);
            const effectiveAnnualRentAED = convertToAED(state.annualRentUSD) * (state.occupancyRate / 100);
            const effectiveAnnualRentUSD = convertToUSD(effectiveAnnualRentAED);
            const annualMortgagePaymentAED = state.hasMortgage ? monthlyMortgageAED * 12 : 0;
            const annualMortgagePaymentUSD = convertToUSD(annualMortgagePaymentAED);
            const netAnnualIncomeAED = effectiveAnnualRentAED - annualServiceChargeAED - annualMortgagePaymentAED;
            const netAnnualIncomeUSD = convertToUSD(netAnnualIncomeAED);
            const netMonthlyIncomeUSD = netAnnualIncomeUSD / 12;
            const grossRentalYieldAnnual = (effectiveAnnualRentAED / purchasePriceAED) * 100;
            const grossRentalYieldMonthly = grossRentalYieldAnnual / 12;
            const netRentalYieldAnnual = (netAnnualIncomeAED / purchasePriceAED) * 100;
            const netRentalYieldMonthly = netRentalYieldAnnual / 12;
            const futureValueAED = purchasePriceAED * Math.pow(1 + state.annualRentIncrease / 100, state.holdingPeriodYears);
            const futureValueUSD = convertToUSD(futureValueAED);
            const capitalGainAED = futureValueAED - purchasePriceAED;
            const capitalGainUSD = convertToUSD(capitalGainAED);
            const totalReturnAED = capitalGainAED + totalRentalIncomeAED;
            const totalReturnUSD = convertToUSD(totalReturnAED);
            const totalROI = (totalReturnAED / actualCashInvestedAED) * 100;
            const paybackPeriodYears = actualCashInvestedAED / (netAnnualIncomeAED > 0 ? netAnnualIncomeAED : 1);
            
            return {
                purchasePriceAED, dldFeeAED, dldFeeUSD, adminFeeUSD, annualServiceChargeUSD, propertySizeM2,
                downPaymentUSD, duringConstructionUSD, onHandoverUSD, phppUSD, phppMonthlyUSD, initialFeesUSD,
                mortgageAmountUSD, monthlyMortgageUSD, totalMortgagePaidUSD, annualMortgagePaymentUSD,
                actualCashInvestedUSD, effectiveAnnualRentUSD, netAnnualIncomeUSD, netMonthlyIncomeUSD,
                grossRentalYieldAnnual, grossRentalYieldMonthly, netRentalYieldAnnual, netRentalYieldMonthly,
                futureValueUSD, capitalGainUSD, totalRentalIncomeUSD, totalReturnUSD, totalROI, paybackPeriodYears
            };
        }
        
        function render() {
            const calc = calculate();
            const currentDate = new Date();
            const investmentDate = `${currentDate.getFullYear()} Q${Math.ceil((currentDate.getMonth() + 1) / 3)}`;
            
            app.innerHTML = `
                <div class="w-full min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-2">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-gradient-to-r from-amber-500 to-orange-600 rounded-lg shadow-lg p-2 mb-3">
                            <h1 class="text-xl font-bold text-white">Dubai Real Estate ROI Calculator</h1>
                        </div>
                        
                        <div class="grid lg:grid-cols-5 gap-3">
                            <div class="lg:col-span-3 space-y-2">
                                ${renderInputSection('Purchase Details', [
                                    { label: 'Price (USD)', value: state.purchasePriceUSD, key: 'purchasePriceUSD', type: 'number' },
                                    { label: 'DLD (%)', value: state.dldFeePercent, key: 'dldFeePercent', type: 'number', step: '0.1' },
                                    { label: 'Admin Fee (AED)', value: state.adminFeeAED, key: 'adminFeeAED', type: 'number' }
                                ])}
                                
                                ${renderInputSection('Property Details', [
                                    { label: 'Size (sqft)', value: state.propertySizeSqft, key: 'propertySizeSqft', type: 'number' },
                                    { label: 'Service (AED/sqft)', value: state.serviceChargePerSqftAED, key: 'serviceChargePerSqftAED', type: 'number' },
                                    { label: 'Occupancy (%)', value: state.occupancyRate, key: 'occupancyRate', type: 'number' }
                                ])}
                                
                                ${renderInputSection('Rental Income', [
                                    { label: 'Annual Rent (USD)', value: state.annualRentUSD, key: 'annualRentUSD', type: 'number' },
                                    { label: 'Rent Increase (%)', value: state.annualRentIncrease, key: 'annualRentIncrease', type: 'number', step: '0.1' },
                                    { label: 'Holding Period (Yrs)', value: state.holdingPeriodYears, key: 'holdingPeriodYears', type: 'number' }
                                ])}
                            </div>
                            
                            <div class="lg:col-span-2 space-y-2">
                                <div class="bg-gradient-to-br from-violet-600 to-purple-600 rounded-lg shadow-lg p-3 text-white">
                                    <h2 class="text-sm font-bold mb-2">Return on Investment</h2>
                                    <div class="bg-white/20 p-3 rounded">
                                        <p class="text-xs mb-1">Total ROI (${state.holdingPeriodYears} Years)</p>
                                        <p class="text-4xl font-bold">${calc.totalROI.toFixed(1)}%</p>
                                    </div>
                                    <div class="mt-2 text-xs space-y-1">
                                        <div class="flex justify-between"><span>Investment:</span><span class="font-bold">${formatUSD(calc.actualCashInvestedUSD)}</span></div>
                                        <div class="flex justify-between"><span>Total Return:</span><span class="font-bold">${formatUSD(calc.totalReturnUSD)}</span></div>
                                        <div class="flex justify-between"><span>Capital Gain:</span><span class="font-bold">${formatUSD(calc.capitalGainUSD)}</span></div>
                                        <div class="flex justify-between"><span>Rental Income:</span><span class="font-bold">${formatUSD(calc.totalRentalIncomeUSD)}</span></div>
                                    </div>
                                </div>
                                
                                <div class="bg-slate-800 rounded-lg shadow-lg p-3 border border-slate-700">
                                    <h2 class="text-sm font-bold text-white mb-2">Rental Yields</h2>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="bg-blue-500/10 border border-blue-500/30 rounded p-2">
                                            <p class="text-xs text-slate-300">Gross (Annual)</p>
                                            <p class="text-lg font-bold text-blue-400">${calc.grossRentalYieldAnnual.toFixed(2)}%</p>
                                        </div>
                                        <div class="bg-green-500/10 border border-green-500/30 rounded p-2">
                                            <p class="text-xs text-slate-300">Net (Annual)</p>
                                            <p class="text-lg font-bold text-green-400">${calc.netRentalYieldAnnual.toFixed(2)}%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const key = e.target.dataset.key;
                    state[key] = e.target.type === 'checkbox' ? e.target.checked : Number(e.target.value.replace(/,/g, ''));
                    render();
                });
            });
        }
        
        function renderInputSection(title, inputs) {
            return `
                <div class="bg-slate-800 rounded-lg shadow-lg p-3 border border-slate-700">
                    <h2 class="text-sm font-bold text-white mb-2">${title}</h2>
                    <div class="grid grid-cols-3 gap-2">
                        ${inputs.map(input => `
                            <div>
                                <label class="block text-xs text-slate-300 mb-1">${input.label}</label>
                                <input 
                                    type="${input.type}" 
                                    value="${input.value}" 
                                    data-key="${input.key}"
                                    ${input.step ? `step="${input.step}"` : ''}
                                    class="w-full px-2 py-1 text-xs bg-slate-700 border border-slate-600 rounded text-white focus:ring-1 focus:ring-amber-500"
                                />
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        render();
    </script>
</body>
</html>
